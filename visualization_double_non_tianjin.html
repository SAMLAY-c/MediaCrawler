<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒéæœ¬ç§‘ç»æµå­¦å¤©æ´¥æš‘æœŸå®ä¹  - æ•°æ®åˆ†æ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.7/dayjs.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #f5f5f5;
            padding-bottom: 50px;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .chart-container {
            height: 400px;
            margin-bottom: 20px;
        }
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 0 0 15px 15px;
        }
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        .tag {
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .tag:hover {
            background-color: #dee2e6;
        }
        .post-card {
            border-left: 4px solid #007bff;
        }
        .comment-card {
            border-left: 4px solid #28a745;
        }
        .search-box {
            margin-bottom: 20px;
        }
        .filter-section {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        #postsList, #commentsList {
            max-height: 600px;
            overflow-y: auto;
        }
        .source-link {
            color: #007bff;
            text-decoration: none;
        }
        .source-link:hover {
            text-decoration: underline;
        }
        .pagination {
            margin-top: 20px;
            justify-content: center;
        }
        .badge-post {
            background-color: #007bff;
            color: white;
        }
        .badge-comment {
            background-color: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="header text-center">
        <h1>åŒéæœ¬ç§‘ç»æµå­¦å¤©æ´¥æš‘æœŸå®ä¹  - æ•°æ®åˆ†æ</h1>
        <p class="lead">åŸºäºå°çº¢ä¹¦å¹³å°æ•°æ®</p>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">æ•°æ®æ¦‚è§ˆ</h5>
                    </div>
                    <div class="card-body">
                        <div id="overviewChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">äº’åŠ¨æ•°æ®åˆ†æ</h5>
                    </div>
                    <div class="card-body">
                        <div id="engagementChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">çƒ­é—¨æ ‡ç­¾</h5>
                    </div>
                    <div class="card-body">
                        <div id="tagChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">å‘å¸ƒæ—¶é—´åˆ†å¸ƒ</h5>
                    </div>
                    <div class="card-body">
                        <div id="timeChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">åœ°åŒºåˆ†å¸ƒ</h5>
                    </div>
                    <div class="card-body">
                        <div id="regionChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">å†…å®¹æ£€ç´¢</h5>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="contentType">å†…å®¹ç±»å‹</label>
                                        <select class="form-control" id="contentType">
                                            <option value="all">å…¨éƒ¨</option>
                                            <option value="post">å¸–å­</option>
                                            <option value="comment">è¯„è®º</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="sortBy">æ’åºæ–¹å¼</label>
                                        <select class="form-control" id="sortBy">
                                            <option value="time-desc">æ—¶é—´ (æœ€æ–°)</option>
                                            <option value="time-asc">æ—¶é—´ (æœ€æ—©)</option>
                                            <option value="likes-desc">ç‚¹èµæ•° (ä»é«˜åˆ°ä½)</option>
                                            <option value="comments-desc">è¯„è®ºæ•° (ä»é«˜åˆ°ä½)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="searchInput">å…³é”®è¯æœç´¢</label>
                                        <input type="text" class="form-control" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯">
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <button id="searchBtn" class="btn btn-primary">æœç´¢</button>
                                    <button id="resetBtn" class="btn btn-secondary ml-2">é‡ç½®</button>
                                </div>
                            </div>
                        </div>

                        <!-- æœç´¢ç»“æœåŒºåŸŸ -->
                        <div class="results-section">
                            <h6><span id="resultCount">0</span> æ¡ç»“æœ</h6>
                            <div id="searchResults">
                                <!-- æœç´¢ç»“æœå°†åŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                            </div>
                            <nav aria-label="Page navigation">
                                <ul class="pagination" id="pagination">
                                    <!-- åˆ†é¡µæ§ä»¶å°†åŠ¨æ€ç”Ÿæˆ -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">çƒ­é—¨å¸–å­ <span class="badge badge-post">å¸–å­</span></h5>
                    </div>
                    <div class="card-body">
                        <div id="postsList">
                            <!-- å¸–å­åˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">æœ€æ–°è¯„è®º <span class="badge badge-comment">è¯„è®º</span></h5>
                    </div>
                    <div class="card-body">
                        <div id="commentsList">
                            <!-- è¯„è®ºåˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åŠ è½½æ•°æ®
        let postsData = [];
        let commentsData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredData = [];
        const KEYWORD = "åŒéæœ¬ç§‘ç»æµå­¦å¤©æ´¥æš‘æœŸå®ä¹ ";

        // åŠ è½½æ•°æ®æ–‡ä»¶
        async function loadData() {
            try {
                // è·å–åŸºäºå…³é”®è¯çš„ç›®å½•ä¸‹çš„æœ€æ–°æ–‡ä»¶
                const keywordDir = KEYWORD.replace(/,/g, '_').replace(/ /g, '_');
                const postsPath = `data/xhs/json/${keywordDir}/search_contents_2025-05-04.json`;
                const commentsPath = `data/xhs/json/${keywordDir}/search_comments_2025-05-04.json`;
                
                // å°è¯•å…ˆåŠ è½½å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶
                try {
                    const postsResponse = await fetch(postsPath);
                    postsData = await postsResponse.json();
                    
                    const commentsResponse = await fetch(commentsPath);
                    commentsData = await commentsResponse.json();
                } catch (e) {
                    // å¦‚æœæ‰¾ä¸åˆ°æ–°æ ¼å¼æ–‡ä»¶ï¼Œå›é€€åˆ°åŸæ¥çš„è·¯å¾„
                    console.log("æ‰¾ä¸åˆ°æ–°æ ¼å¼æ–‡ä»¶ï¼Œå°è¯•åŠ è½½è€æ ¼å¼æ–‡ä»¶");
                    const postsResponse = await fetch('data/xhs/json/search_contents_2025-05-04.json');
                    postsData = await postsResponse.json();
                    
                    const commentsResponse = await fetch('data/xhs/json/search_comments_2025-05-04.json');
                    commentsData = await commentsResponse.json();
                }
                
                // åˆå§‹åŒ–é¡µé¢
                initCharts();
                displayTopPosts();
                displayLatestComments();
                setupEventListeners();
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                document.body.innerHTML = `
                    <div class="container mt-5">
                        <div class="alert alert-danger">
                            <h4>æ•°æ®åŠ è½½å¤±è´¥</h4>
                            <p>æ— æ³•åŠ è½½æ•°æ®æ–‡ä»¶ï¼Œè¯·ç¡®ä¿æ•°æ®æ–‡ä»¶è·¯å¾„æ­£ç¡®ã€‚</p>
                            <p>é”™è¯¯è¯¦æƒ…: ${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            // æ•°æ®æ¦‚è§ˆå›¾è¡¨
            const overviewChart = echarts.init(document.getElementById('overviewChart'));
            const overviewOption = {
                title: {
                    text: 'æ•°æ®æ•°é‡æ¦‚è§ˆ',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    data: ['å¸–å­', 'è¯„è®º']
                },
                series: [
                    {
                        name: 'æ•°æ®ç±»å‹',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '20',
                                fontWeight: 'bold'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: [
                            { value: postsData.length, name: 'å¸–å­' },
                            { value: commentsData.length, name: 'è¯„è®º' }
                        ]
                    }
                ]
            };
            overviewChart.setOption(overviewOption);

            // äº’åŠ¨æ•°æ®åˆ†æå›¾è¡¨
            const engagementData = postsData.map(post => {
                const likedCount = parseInt(post.liked_count.replace(/[^\d]/g, '')) || 0;
                const commentCount = parseInt(post.comment_count.replace(/[^\d]/g, '')) || 0;
                const collectedCount = parseInt(post.collected_count.replace(/[^\d]/g, '')) || 0;
                const shareCount = parseInt(post.share_count.replace(/[^\d]/g, '')) || 0;
                
                return {
                    title: post.title,
                    likes: likedCount,
                    comments: commentCount,
                    collects: collectedCount,
                    shares: shareCount
                };
            }).sort((a, b) => b.likes - a.likes).slice(0, 10);

            const engagementChart = echarts.init(document.getElementById('engagementChart'));
            const engagementOption = {
                title: {
                    text: 'çƒ­é—¨å¸–å­äº’åŠ¨æ•°æ®',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                legend: {
                    data: ['ç‚¹èµ', 'è¯„è®º', 'æ”¶è—', 'åˆ†äº«'],
                    top: 30
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value'
                },
                yAxis: {
                    type: 'category',
                    data: engagementData.map((item, index) => `å¸–å­${index+1}`),
                    axisLabel: {
                        formatter: function(value) {
                            return value;
                        }
                    }
                },
                series: [
                    {
                        name: 'ç‚¹èµ',
                        type: 'bar',
                        stack: 'total',
                        emphasis: { focus: 'series' },
                        data: engagementData.map(item => item.likes)
                    },
                    {
                        name: 'è¯„è®º',
                        type: 'bar',
                        stack: 'total',
                        emphasis: { focus: 'series' },
                        data: engagementData.map(item => item.comments)
                    },
                    {
                        name: 'æ”¶è—',
                        type: 'bar',
                        stack: 'total',
                        emphasis: { focus: 'series' },
                        data: engagementData.map(item => item.collects)
                    },
                    {
                        name: 'åˆ†äº«',
                        type: 'bar',
                        stack: 'total',
                        emphasis: { focus: 'series' },
                        data: engagementData.map(item => item.shares)
                    }
                ]
            };
            engagementChart.setOption(engagementOption);

            // çƒ­é—¨æ ‡ç­¾å›¾è¡¨
            const tagMap = {};
            postsData.forEach(post => {
                if (post.tag_list) {
                    const tags = post.tag_list.split(',');
                    tags.forEach(tag => {
                        if (tag.trim()) {
                            tagMap[tag.trim()] = (tagMap[tag.trim()] || 0) + 1;
                        }
                    });
                }
            });
            
            const tagData = Object.entries(tagMap)
                .map(([name, value]) => ({ name, value }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 20);

            const tagChart = echarts.init(document.getElementById('tagChart'));
            const tagOption = {
                title: {
                    text: 'çƒ­é—¨æ ‡ç­¾è¯äº‘',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c}'
                },
                series: [{
                    type: 'wordCloud',
                    name: 'æ ‡ç­¾å‡ºç°æ¬¡æ•°',
                    shape: 'circle',
                    sizeRange: [15, 60],
                    rotationRange: [0, 0],
                    rotationStep: 45,
                    gridSize: 8,
                    drawOutOfBound: false,
                    textStyle: {
                        fontFamily: 'sans-serif',
                        fontWeight: 'bold',
                        color: function () {
                            return 'rgb(' + [
                                Math.round(Math.random() * 160 + 60),
                                Math.round(Math.random() * 160 + 60),
                                Math.round(Math.random() * 160 + 60)
                            ].join(',') + ')';
                        }
                    },
                    emphasis: {
                        textStyle: {
                            shadowBlur: 10,
                            shadowColor: '#333'
                        }
                    },
                    data: tagData
                }]
            };
            tagChart.setOption(tagOption);

            // å‘å¸ƒæ—¶é—´åˆ†å¸ƒå›¾è¡¨
            const timeData = {};
            postsData.forEach(post => {
                const date = new Date(post.time);
                const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                timeData[dateStr] = (timeData[dateStr] || 0) + 1;
            });
            
            const timeChartData = Object.entries(timeData)
                .map(([date, count]) => ({ date, count }))
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            const timeChart = echarts.init(document.getElementById('timeChart'));
            const timeOption = {
                title: {
                    text: 'å¸–å­å‘å¸ƒæ—¶é—´åˆ†å¸ƒ',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    data: timeChartData.map(item => item.date),
                    axisLabel: {
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'å¸–å­æ•°é‡'
                },
                series: [{
                    name: 'å¸–å­æ•°é‡',
                    type: 'line',
                    data: timeChartData.map(item => item.count),
                    smooth: true,
                    symbol: 'emptyCircle',
                    symbolSize: 8,
                    lineStyle: {
                        width: 3
                    },
                    areaStyle: {
                        opacity: 0.2
                    }
                }]
            };
            timeChart.setOption(timeOption);

            // åœ°åŒºåˆ†å¸ƒå›¾è¡¨
            const regionMap = {};
            postsData.forEach(post => {
                if (post.ip_location) {
                    regionMap[post.ip_location] = (regionMap[post.ip_location] || 0) + 1;
                }
            });
            
            const regionData = Object.entries(regionMap)
                .map(([name, value]) => ({ name, value }))
                .sort((a, b) => b.value - a.value);

            const regionChart = echarts.init(document.getElementById('regionChart'));
            const regionOption = {
                title: {
                    text: 'å‘å¸ƒåœ°åŒºåˆ†å¸ƒ',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                series: [{
                    name: 'åœ°åŒºåˆ†å¸ƒ',
                    type: 'pie',
                    radius: '65%',
                    center: ['50%', '50%'],
                    data: regionData,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    label: {
                        formatter: '{b}: {c} ({d}%)'
                    }
                }]
            };
            regionChart.setOption(regionOption);

            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“å›¾è¡¨
            window.addEventListener('resize', function() {
                overviewChart.resize();
                engagementChart.resize();
                tagChart.resize();
                timeChart.resize();
                regionChart.resize();
            });
        }

        // æ˜¾ç¤ºçƒ­é—¨å¸–å­
        function displayTopPosts() {
            const topPosts = [...postsData]
                .sort((a, b) => {
                    const aLikes = parseInt(a.liked_count.replace(/[^\d]/g, '')) || 0;
                    const bLikes = parseInt(b.liked_count.replace(/[^\d]/g, '')) || 0;
                    return bLikes - aLikes;
                })
                .slice(0, 10);
            
            const postsHtml = topPosts.map(post => {
                const date = new Date(post.time);
                const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                
                return `
                    <div class="card post-card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">${post.title}</h6>
                            <p class="card-text small">${post.desc.substring(0, 100)}${post.desc.length > 100 ? '...' : ''}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <span class="me-2">ğŸ‘ ${post.liked_count}</span>
                                    <span class="me-2">ğŸ’¬ ${post.comment_count}</span>
                                    <span>${dateStr}</span>
                                </small>
                                <a href="${post.note_url}" target="_blank" class="source-link">æŸ¥çœ‹åŸæ–‡</a>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('postsList').innerHTML = postsHtml;
        }

        // æ˜¾ç¤ºæœ€æ–°è¯„è®º
        function displayLatestComments() {
            const latestComments = [...commentsData]
                .sort((a, b) => new Date(b.create_time) - new Date(a.create_time))
                .slice(0, 10);
            
            const commentsHtml = latestComments.map(comment => {
                const date = new Date(comment.create_time);
                const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                
                // æŸ¥æ‰¾å¯¹åº”çš„å¸–å­
                const relatedPost = postsData.find(post => post.note_id === comment.note_id) || { title: 'æœªçŸ¥å¸–å­' };
                
                return `
                    <div class="card comment-card mb-3">
                        <div class="card-body">
                            <p class="card-text">${comment.content}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <span class="me-2">ğŸ‘¤ ${comment.nickname}</span>
                                    <span class="me-2">ğŸ‘ ${comment.like_count || 0}</span>
                                    <span>${dateStr}</span>
                                </small>
                                <small class="text-muted">è¯„è®ºäº: ${relatedPost.title.substring(0, 15)}${relatedPost.title.length > 15 ? '...' : ''}</small>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('commentsList').innerHTML = commentsHtml;
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('resetBtn').addEventListener('click', resetSearch);
            document.getElementById('contentType').addEventListener('change', updateFilterOptions);
        }

        // æ‰§è¡Œæœç´¢
        function performSearch() {
            const contentType = document.getElementById('contentType').value;
            const sortBy = document.getElementById('sortBy').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            // æ ¹æ®å†…å®¹ç±»å‹è¿‡æ»¤æ•°æ®
            if (contentType === 'post') {
                filteredData = postsData.filter(post => {
                    return (post.title.toLowerCase().includes(searchTerm) || 
                           post.desc.toLowerCase().includes(searchTerm));
                }).map(post => ({ ...post, type: 'post' }));
            } else if (contentType === 'comment') {
                filteredData = commentsData.filter(comment => {
                    return comment.content.toLowerCase().includes(searchTerm);
                }).map(comment => ({ ...comment, type: 'comment' }));
            } else {
                const filteredPosts = postsData.filter(post => {
                    return (post.title.toLowerCase().includes(searchTerm) || 
                           post.desc.toLowerCase().includes(searchTerm));
                }).map(post => ({ ...post, type: 'post' }));
                
                const filteredComments = commentsData.filter(comment => {
                    return comment.content.toLowerCase().includes(searchTerm);
                }).map(comment => ({ ...comment, type: 'comment' }));
                
                filteredData = [...filteredPosts, ...filteredComments];
            }
            
            // æ’åºæ•°æ®
            sortFilteredData(sortBy);
            
            // æ›´æ–°ç»“æœè®¡æ•°å¹¶å±•ç¤ºç¬¬ä¸€é¡µ
            document.getElementById('resultCount').textContent = filteredData.length;
            currentPage = 1;
            displaySearchResults();
        }

        // æ’åºè¿‡æ»¤åçš„æ•°æ®
        function sortFilteredData(sortBy) {
            switch (sortBy) {
                case 'time-desc':
                    filteredData.sort((a, b) => {
                        const aTime = a.type === 'post' ? a.time : a.create_time;
                        const bTime = b.type === 'post' ? b.time : b.create_time;
                        return bTime - aTime;
                    });
                    break;
                case 'time-asc':
                    filteredData.sort((a, b) => {
                        const aTime = a.type === 'post' ? a.time : a.create_time;
                        const bTime = b.type === 'post' ? b.time : b.create_time;
                        return aTime - bTime;
                    });
                    break;
                case 'likes-desc':
                    filteredData.sort((a, b) => {
                        const aLikes = a.type === 'post' ? 
                            (parseInt(a.liked_count.replace(/[^\d]/g, '')) || 0) : 
                            (parseInt(a.like_count) || 0);
                        const bLikes = b.type === 'post' ? 
                            (parseInt(b.liked_count.replace(/[^\d]/g, '')) || 0) : 
                            (parseInt(b.like_count) || 0);
                        return bLikes - aLikes;
                    });
                    break;
                case 'comments-desc':
                    filteredData.sort((a, b) => {
                        if (a.type === 'post' && b.type === 'post') {
                            const aComments = parseInt(a.comment_count.replace(/[^\d]/g, '')) || 0;
                            const bComments = parseInt(b.comment_count.replace(/[^\d]/g, '')) || 0;
                            return bComments - aComments;
                        } else if (a.type === 'post') {
                            return -1;
                        } else if (b.type === 'post') {
                            return 1;
                        } else {
                            const aSubComments = parseInt(a.sub_comment_count) || 0;
                            const bSubComments = parseInt(b.sub_comment_count) || 0;
                            return bSubComments - aSubComments;
                        }
                    });
                    break;
            }
        }

        // å±•ç¤ºæœç´¢ç»“æœ
        function displaySearchResults() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPageData = filteredData.slice(startIndex, endIndex);
            
            const resultsHtml = currentPageData.map(item => {
                if (item.type === 'post') {
                    const date = new Date(item.time);
                    const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    
                    return `
                        <div class="card post-card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="card-title mb-0">${item.title}</h6>
                                    <span class="badge badge-post">å¸–å­</span>
                                </div>
                                <p class="card-text small">${item.desc.substring(0, 200)}${item.desc.length > 200 ? '...' : ''}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <span class="me-2">ğŸ‘ ${item.liked_count}</span>
                                        <span class="me-2">ğŸ’¬ ${item.comment_count}</span>
                                        <span>${dateStr}</span>
                                    </small>
                                    <a href="${item.note_url}" target="_blank" class="source-link">æŸ¥çœ‹åŸæ–‡</a>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    const date = new Date(item.create_time);
                    const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    
                    // æŸ¥æ‰¾å¯¹åº”çš„å¸–å­
                    const relatedPost = postsData.find(post => post.note_id === item.note_id) || { title: 'æœªçŸ¥å¸–å­', note_url: '#' };
                    
                    return `
                        <div class="card comment-card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="card-title mb-0">æ¥è‡ª ${item.nickname} çš„è¯„è®º</h6>
                                    <span class="badge badge-comment">è¯„è®º</span>
                                </div>
                                <p class="card-text">${item.content}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <span class="me-2">ğŸ‘ ${item.like_count || 0}</span>
                                        <span>${dateStr}</span>
                                    </small>
                                    <small class="text-muted">
                                        è¯„è®ºäº: <a href="${relatedPost.note_url}" target="_blank" class="source-link">
                                            ${relatedPost.title.substring(0, 15)}${relatedPost.title.length > 15 ? '...' : ''}
                                        </a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            document.getElementById('searchResults').innerHTML = resultsHtml || '<div class="alert alert-info">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»“æœ</div>';
            
            // æ›´æ–°åˆ†é¡µ
            updatePagination();
        }

        // é‡ç½®æœç´¢
        function resetSearch() {
            document.getElementById('contentType').value = 'all';
            document.getElementById('sortBy').value = 'time-desc';
            document.getElementById('searchInput').value = '';
            
            filteredData = [];
            document.getElementById('resultCount').textContent = '0';
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('pagination').innerHTML = '';
        }

        // æ›´æ–°è¿‡æ»¤é€‰é¡¹
        function updateFilterOptions() {
            const contentType = document.getElementById('contentType').value;
            const sortBySelect = document.getElementById('sortBy');
            
            // é‡ç½®æ’åºé€‰é¡¹
            sortBySelect.innerHTML = `
                <option value="time-desc">æ—¶é—´ (æœ€æ–°)</option>
                <option value="time-asc">æ—¶é—´ (æœ€æ—©)</option>
                <option value="likes-desc">ç‚¹èµæ•° (ä»é«˜åˆ°ä½)</option>
            `;
            
            // å¦‚æœé€‰æ‹©äº†å¸–å­ï¼Œæ·»åŠ è¯„è®ºæ•°æ’åºé€‰é¡¹
            if (contentType === 'post' || contentType === 'all') {
                sortBySelect.innerHTML += `<option value="comments-desc">è¯„è®ºæ•° (ä»é«˜åˆ°ä½)</option>`;
            }
        }

        // æ›´æ–°åˆ†é¡µæ§ä»¶
        function updatePagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            let paginationHtml = '';
            
            if (totalPages > 1) {
                paginationHtml += `
                    <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" data-page="${currentPage - 1}">ä¸Šä¸€é¡µ</a>
                    </li>
                `;
                
                // æ˜¾ç¤ºé¡µç 
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, startPage + 4);
                
                for (let i = startPage; i <= endPage; i++) {
                    paginationHtml += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" data-page="${i}">${i}</a>
                        </li>
                    `;
                }
                
                paginationHtml += `
                    <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" data-page="${currentPage + 1}">ä¸‹ä¸€é¡µ</a>
                    </li>
                `;
            }
            
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = paginationHtml;
            
            // æ·»åŠ åˆ†é¡µäº‹ä»¶ç›‘å¬å™¨
            paginationElement.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = parseInt(this.getAttribute('data-page'));
                    if (page && page !== currentPage) {
                        currentPage = page;
                        displaySearchResults();
                        // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                        document.getElementById('searchResults').scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html> 